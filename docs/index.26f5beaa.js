function e(e,t,n,s){Object.defineProperty(e,t,{get:n,set:s,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},o={},r=n.parcelRequire7c00;null==r&&((r=function(e){if(e in s)return s[e].exports;if(e in o){var t=o[e];delete o[e];var n={id:e,exports:{}};return s[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){o[e]=t},n.parcelRequire7c00=r),r.register("27Lyk",(function(t,n){var s,o;e(t.exports,"register",(()=>s),(e=>s=e)),e(t.exports,"resolve",(()=>o),(e=>o=e));var r={};s=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)r[t[n]]=e[t[n]]},o=function(e){var t=r[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r("27Lyk").register(JSON.parse('{"l1gf1":"index.26f5beaa.js","juO8e":"BongoCat.4177eac4.png","cQoTT":"BongoCat1.9a890426.png","hgdhd":"BongoCat2.1e216f80.png"}'));class a{constructor(e,t,n,s,o=[]){this.userID=e,this.username=t,this.password=n,this.profilePic=s,this.posts=o}}function i(){return localStorage.getItem("userLoggedIn")}const c="https://socialmediaplatform-368e0-default-rtdb.europe-west1.firebasedatabase.app/";async function d(){const e=`${c}.json`,t=await fetch(e),n=await t.json(),s=[];if(n&&"object"==typeof n)for(const[e,t]of Object.entries(n))if("object"==typeof t){const n=t;s.push({userID:e,username:n.username,password:n.password,posts:n.posts,profilePic:n.profilePic})}return s}async function l(e){const t=`${c}.json`,n={method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=UTF-8"}};return await fetch(t,n).then((e=>e.json())).then((e=>e.name))}async function u(e){const t=`${c}${e}.json`;await fetch(t,{method:"DELETE"})}async function p(e,t,n){const s=`${c}${t}/posts/${n}.json`,o={method:"PUT",body:JSON.stringify(e),headers:{"Content-Type":"application/json; charset=uUTFtf-8"}};await fetch(s,o)}function m(e,t,n){try{const s=n.find((t=>t.username===e));return s&&s.password===t?(localStorage.setItem("userLoggedIn",e),!0):(alert("wrong password"),!1)}catch(e){return alert("an error occurred"),!1}}function h(){localStorage.removeItem("userLoggedIn")}var f;f=new URL(r("27Lyk").resolve("juO8e"),import.meta.url).toString();var g;g=new URL(r("27Lyk").resolve("cQoTT"),import.meta.url).toString();var E;E=new URL(r("27Lyk").resolve("hgdhd"),import.meta.url).toString();localStorage.getItem("userLoggedIn");const L={pic0:t(f),pic1:t(g),pic2:t(E),default:t(E)};function y(e,t,n){const s=document.createElement("div");s.classList.add("post");const o=document.createElement("div");o.classList.add("userNameAndPic");const r=document.createElement("img");r.classList.add("profilePic");const a=document.createElement("div");a.classList.add("username"),a.innerText=t.username;const i=document.createElement("div");i.classList.add("message"),i.innerText=e.message;const c=document.createElement("div");c.classList.add("timestamp");const d=new Date(e.timestamp);c.innerText=`${d.toLocaleDateString()} ${d.toLocaleTimeString()}`;const l=t.profilePic;r.src=L[l],o.append(r,a),s.append(o,i,c),n.append(s)}class v{constructor(e,t,n,s){this.app=e,this.setPage=t,this.user=n,this.isYourProfile=s,this.sectionHeader=this.renderHeader(),this.sectionProfile=this.renderProfile()}render(){this.app.replaceChildren(),document.title=this.user.username,this.app.append(this.sectionHeader,this.sectionProfile),this.syncPosts()}onDashboard(){this.setPage("dashboard")}onLogout(){h(),this.setPage("login")}onDelete(){h(),this.setPage("login")}renderHeader(){const e=document.createElement("section");e.classList.add("header");const t=document.createElement("h1");this.isYourProfile?t.textContent="Your profile":t.textContent=`${this.user.username}'s profile`,e.appendChild(t);const n=document.createElement("div");n.classList.add("nav-info");const s=document.createElement("button");s.classList.add("dashboard-btn"),s.textContent="Home",s.addEventListener("click",(()=>this.onDashboard())),n.appendChild(s);const o=document.createElement("button");if(o.classList.add("log-out-btn"),o.textContent="Log out",o.addEventListener("click",(()=>this.onLogout())),n.appendChild(o),this.isYourProfile){const e=document.createElement("button");e.setAttribute("id","delete-account"),e.textContent="Delete my account",e.addEventListener("click",(()=>{t.style.display="block"})),n.appendChild(e);const t=document.createElement("div");t.setAttribute("id","confirm-delete-popup"),t.classList.add("popup");const s=document.createElement("div");s.classList.add("popup-content"),t.appendChild(s);const o=document.createElement("p");o.textContent="Are you sure you want to delete? This change is permanent",s.appendChild(o);const r=document.createElement("div");r.classList.add("popup-buttons"),s.appendChild(r);const a=document.createElement("button");a.setAttribute("id","confirm-delete"),a.textContent="Confirm",a.addEventListener("click",(()=>this.deleteMyProfile())),r.appendChild(a);const i=document.createElement("button");i.setAttribute("id","cancel-delete"),i.textContent="Cancel",i.addEventListener("click",(()=>{t.style.display="none"})),r.appendChild(i),n.appendChild(t)}const r=document.createElement("div");return r.classList.add("user-info"),n.appendChild(r),e.appendChild(n),e}renderProfile(){const e=document.createElement("section");e.classList.add("profile-container");const t=document.createElement("div");if(t.classList.add("profile-posts"),this.isYourProfile){const e=document.createElement("form");e.setAttribute("id","newPostForm"),t.appendChild(e);const n=document.createElement("input");n.setAttribute("type","text"),n.setAttribute("placeholder","Post positive message"),n.setAttribute("id","new-post"),e.appendChild(n);const s=document.createElement("button");s.textContent="Publish",e.appendChild(s),e.addEventListener("submit",(e=>{e.preventDefault(),this.publishPost()}))}const n=document.createElement("div");n.setAttribute("id","my-posts"),t.appendChild(n),e.appendChild(t);const s=document.createElement("div");s.classList.add("user-card"),e.appendChild(s);const o=document.createElement("h3");return s.appendChild(o),e}async syncPosts(){const e=document.querySelector("#my-posts"),t=await d(),n=this.user.username,s=t.find((e=>e.username===n));this.user=s,e.replaceChildren(),this.user.posts.reverse().forEach((t=>{y(t,this.user,e)}))}async publishPost(){const e={message:document.querySelector("#new-post").value,timestamp:(new Date).toISOString()};(await d()).forEach((t=>{if(t&&t.username===this.user.username){const n=t.posts.length;p(e,t.userID,n).then((()=>this.syncPosts()))}}))}async deleteMyProfile(){const e=await d(),t=i();e.forEach((e=>{e&&e.username===t&&u(e.userID).then((()=>this.onDelete()))}))}}class w{constructor(e,t){this.app=e,this.setPage=t,this.sectionHeader=this.renderHeader(),this.sectionFeed=this.renderFeed(),this.sectionUserList=this.renderUserList()}render(){this.app.replaceChildren(),document.title="Dashboard Page",this.app.append(this.sectionHeader,this.sectionFeed,this.sectionUserList),this.syncFeed(),this.syncAllUsers()}async onOpenMyProfile(){const e=await d(),t=i();if(!t)return void this.setPage("login");const n=e.find((e=>e.username===t));n?this.setPage(new v(this.app,this.setPage,n,!0)):this.setPage("login")}onLogout(){h(),this.setPage("login")}renderHeader(){const e=document.createElement("section");e.classList.add("header");const t=document.createElement("h1");t.textContent="Your feed",e.appendChild(t);const n=document.createElement("section");n.classList.add("nav-info");const s=document.createElement("button");s.classList.add("profile-btn"),s.textContent="My profile",s.addEventListener("click",(()=>this.onOpenMyProfile())),n.appendChild(s);const o=document.createElement("button");o.classList.add("log-out-btn"),o.textContent="Log out",o.addEventListener("click",(()=>this.onLogout())),n.appendChild(o);const r=document.createElement("section");return r.classList.add("user-info"),n.appendChild(r),e.appendChild(n),e}renderFeed(){const e=document.createElement("section");e.classList.add("feed-container");const t=document.createElement("section");return t.classList.add("feed"),t.id="feed-list",e.appendChild(t),e}renderUserList(){const e=document.createElement("section");e.classList.add("user-container");const t=document.createElement("h3");t.textContent="All user(s):",e.appendChild(t);const n=document.createElement("div");return n.id="all-users",e.appendChild(n),e}async syncAllUsers(){const e=document.querySelector("#all-users");if(!e)return;e.replaceChildren();(await d()).forEach((t=>{if(t){const n=document.createElement("div"),s=document.createElement("a");s.innerHTML=t.username,s.addEventListener("click",(()=>this.setPage(new v(this.app,this.setPage,t,!1)))),n.append(s),e.appendChild(n)}}))}async syncFeed(){const e=document.querySelector("#feed-list");if(!e)return;e.replaceChildren();const t=[];(await d()).forEach((e=>{if(e){const n=e.username,s=e.profilePic;e.posts.forEach((e=>{const o=e.message,r=e.timestamp;t.push({username:n,profilePic:s,message:o,timestamp:r})}))}})),t.sort(((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())),t.forEach((t=>{y(t,t,e)}))}}const b=[t(f),t(g),t(E)];class C{constructor(e,t){this.app=e,this.setPage=t,this.loginForm=this.renderLoginForm(),this.registerForm=this.renderRegisterForm(),this.loginForm.addEventListener("submit",(e=>this.onLogin(e))),this.registerForm.addEventListener("submit",(e=>this.onRegister(e)))}render(){this.app.replaceChildren(),document.title="Login Page",this.app.append(this.loginForm,this.registerForm),i()&&this.setPage("dashboard")}async onLogin(e){e.preventDefault();m(document.querySelector("#login-username").value,document.querySelector("#login-password").value,await d())?this.setPage("dashboard"):alert("Couldn't find your username or password, make sure you have a valid username and password")}async onRegister(e){e.preventDefault();const t=document.querySelector("#register-username").value,n=document.querySelector("#register-password").value,s=document.querySelector('input[name="avatarPic"]:checked').value,o=(new Date).toISOString(),r=new a("",t,n,s,[{message:"Hello world, first status message",timestamp:o}]);(await d()).find((e=>e.username===t))?alert("Name already taken!"):(l(r),alert(`Welcome! ${t} you are now registered`))}renderLoginForm(){const e=document.createElement("form");e.classList.add("login-form");const t=document.createElement("h2");t.innerHTML="Login";const n=document.createElement("input");n.placeholder="Username",n.id="login-username";const s=document.createElement("input");s.placeholder="Password",s.id="login-password",s.type="password";const o=document.createElement("button");return o.innerHTML="Log in",e.append(t,n,s,o),e}renderRegisterForm(){const e=document.createElement("form");e.classList.add("register-form");const t=document.createElement("h2");t.innerHTML="Register user";const n=document.createElement("input");n.placeholder="Username",n.id="register-username";const s=document.createElement("input");s.placeholder="Password",s.id="register-password",s.type="password";const o=document.createElement("button");o.innerHTML="Register";document.createElement("section");document.createElement("h3").innerHTML="Choose avatars";const r=document.createElement("div");r.classList.add("avatars-container");for(let e=0;e<b.length;e++){const t=b[e],n=document.createElement("label"),s=document.createElement("input");s.type="radio",s.name="avatarPic",s.value=`pic${e}`,0===e&&(s.checked=!0);const o=document.createElement("img");o.src=t,n.append(s,o),r.append(n)}return e.append(t,n,s,o,r),e}}window.onload=async function(){const e=document.querySelector("#app");if(!e)throw new Error("No app container found");const t=new Map;let n;function s(e){if("string"==typeof e)n=t.get(e);else{if("object"!=typeof e)throw new Error("Not a valid page");n=e}n&&n.render()}const o=new C(e,s),r=new w(e,s);t.set("login",o),t.set("dashboard",r),s("login")};
//# sourceMappingURL=index.26f5beaa.js.map
